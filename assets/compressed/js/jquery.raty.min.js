/*
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.5.2
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 */
(function(A){var B={init:function(C){return this.each(function(){B.destroy.call(this);this.opt=A.extend(true,{},A.fn.raty.defaults,C);var F=A(this),D=["number","readOnly","score","scoreName"];B._callback.call(this,D);if(this.opt.precision){B._adjustPrecision.call(this)}this.opt.number=B._between(this.opt.number,0,this.opt.numberMax);this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.slice(this.opt.path.length-1,this.opt.path.length)!=="/"){this.opt.path+="/"}this.stars=B._createStars.call(this);this.score=B._createScore.call(this);B._apply.call(this,this.opt.score);var E=this.opt.space?4:0,G=this.opt.width||(this.opt.number*this.opt.size+this.opt.number*E);if(this.opt.cancel){this.cancel=B._createCancel.call(this);G+=(this.opt.size+E)}if(this.opt.readOnly){B._lock.call(this)}else{F.css("cursor","pointer");B._binds.call(this)}if(this.opt.width!==false){F.css("width",G)}B._target.call(this,this.opt.score);F.data({settings:this.opt,raty:true})})},_adjustPrecision:function(){this.opt.targetType="score";this.opt.half=true},_apply:function(C){if(C&&C>0){C=B._between(C,0,this.opt.number);this.score.val(C)}B._fill.call(this,C);if(C){B._roundStars.call(this,C)}},_between:function(C,D,E){return Math.min(Math.max(parseFloat(C),D),E)},_binds:function(){if(this.cancel){B._bindCancel.call(this)}B._bindClick.call(this);B._bindOut.call(this);B._bindOver.call(this)},_bindCancel:function(){B._bindClickCancel.call(this);B._bindOutCancel.call(this);B._bindOverCancel.call(this)},_bindClick:function(){var D=this,C=A(D);D.stars.on("click.raty",function(E){D.score.val((D.opt.half||D.opt.precision)?C.data("score"):this.alt);if(D.opt.click){D.opt.click.call(D,parseFloat(D.score.val()),E)}})},_bindClickCancel:function(){var C=this;C.cancel.on("click.raty",function(D){C.score.removeAttr("value");if(C.opt.click){C.opt.click.call(C,null,D)}})},_bindOut:function(){var C=this;A(this).on("mouseleave.raty",function(E){var D=parseFloat(C.score.val())||undefined;B._apply.call(C,D);B._target.call(C,D,E);if(C.opt.mouseout){C.opt.mouseout.call(C,D,E)}})},_bindOutCancel:function(){var C=this;C.cancel.on("mouseleave.raty",function(D){A(this).attr("src",C.opt.path+C.opt.cancelOff);if(C.opt.mouseout){C.opt.mouseout.call(C,C.score.val()||null,D)}})},_bindOverCancel:function(){var C=this;C.cancel.on("mouseover.raty",function(D){A(this).attr("src",C.opt.path+C.opt.cancelOn);C.stars.attr("src",C.opt.path+C.opt.starOff);B._target.call(C,null,D);if(C.opt.mouseover){C.opt.mouseover.call(C,null)}})},_bindOver:function(){var E=this,D=A(E),C=E.opt.half?"mousemove.raty":"mouseover.raty";E.stars.on(C,function(H){var G=parseInt(this.alt,10);if(E.opt.half){var I=parseFloat((H.pageX-A(this).offset().left)/E.opt.size),F=(I>0.5)?1:0.5;G=G-1+F;B._fill.call(E,G);if(E.opt.precision){G=G-F+I}B._roundStars.call(E,G);D.data("score",G)}else{B._fill.call(E,G)}B._target.call(E,G,H);if(E.opt.mouseover){E.opt.mouseover.call(E,G,H)}})},_callback:function(C){for(i in C){if(typeof this.opt[C[i]]==="function"){this.opt[C[i]]=this.opt[C[i]].call(this)}}},_createCancel:function(){var C=A(this),E=this.opt.path+this.opt.cancelOff,D=A("<img />",{src:E,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"});if(this.opt.cancelPlace=="left"){C.prepend("&#160;").prepend(D)}else{C.append("&#160;").append(D)}return D},_createScore:function(){return A("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this)},_createStars:function(){var D=A(this);for(var F=1;F<=this.opt.number;F++){var C=B._getHint.call(this,F),E=(this.opt.score&&this.opt.score>=F)?"starOn":"starOff";E=this.opt.path+this.opt[E];A("<img />",{src:E,alt:F,title:C}).appendTo(this);if(this.opt.space){D.append((F<this.opt.number)?"&#160;":"")}}return D.children("img")},_error:function(C){A(this).html(C);A.error(C)},_fill:function(K){var C=this,J=0;for(var I=1;I<=C.stars.length;I++){var H=C.stars.eq(I-1),D=C.opt.single?(I==K):(I<=K);if(C.opt.iconRange&&C.opt.iconRange.length>J){var F=C.opt.iconRange[J],G=F.on||C.opt.starOn,L=F.off||C.opt.starOff,E=D?G:L;if(I<=F.range){H.attr("src",C.opt.path+E)}if(I==F.range){J++}}else{var E=D?"starOn":"starOff";H.attr("src",this.opt.path+this.opt[E])}}},_getHint:function(C){var D=this.opt.hints[C-1];return(D==="")?"":(D||C)},_lock:function(){var C=parseInt(this.score.val(),10),D=C?B._getHint.call(this,C):this.opt.noRatedMsg;A(this).data("readonly",true).css("cursor","").attr("title",D);this.score.attr("readonly","readonly");this.stars.attr("title",D);if(this.cancel){this.cancel.hide()}},_roundStars:function(C){var D=(C-Math.floor(C)).toFixed(2);if(D>this.opt.round.down){var E="starOn";if(this.opt.halfShow&&D<this.opt.round.up){E="starHalf"}else{if(D<this.opt.round.full){E="starOff"}}this.stars.eq(Math.ceil(C)-1).attr("src",this.opt.path+this.opt[E])}},_target:function(C,E){if(this.opt.target){var D=A(this.opt.target);if(D.length===0){B._error.call(this,"Target selector invalid or missing!")}if(this.opt.targetFormat.indexOf("{score}")<0){B._error.call(this,'Template "{score}" missing!')}var F=E&&E.type=="mouseover";if(C===undefined){C=this.opt.targetText}else{if(C===null){C=F?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType=="hint"){C=B._getHint.call(this,Math.ceil(C))}else{if(this.opt.precision){C=parseFloat(C).toFixed(1)}}if(!F&&!this.opt.targetKeep){C=this.opt.targetText}}}if(C){C=this.opt.targetFormat.toString().replace("{score}",C)}if(D.is(":input")){D.val(C)}else{D.html(C)}}},_unlock:function(){A(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.removeAttr("readonly","readonly");for(var C=0;C<this.opt.number;C++){this.stars.eq(C).attr("title",B._getHint.call(this,C+1))}if(this.cancel){this.cancel.css("display","")}},cancel:function(C){return this.each(function(){if(A(this).data("readonly")!==true){B[C?"click":"score"].call(this,null);this.score.removeAttr("value")}})},click:function(C){return A(this).each(function(){if(A(this).data("readonly")!==true){B._apply.call(this,C);if(!this.opt.click){B._error.call(this,'You must add the "click: function(score, evt) { }" callback.')}this.opt.click.call(this,C,{type:"click"});B._target.call(this,C)}})},destroy:function(){return A(this).each(function(){var C=A(this),D=C.data("raw");if(D){C.off(".raty").empty().css({cursor:D.style.cursor,width:D.style.width}).removeData("readonly")}else{C.data("raw",C.clone()[0])}})},getScore:function(){var C=[],D;A(this).each(function(){D=this.score.val();C.push(D?parseFloat(D):undefined)});return(C.length>1)?C:C[0]},readOnly:function(C){return this.each(function(){var D=A(this);if(D.data("readonly")!==C){if(C){D.off(".raty").children("img").off(".raty");B._lock.call(this)}else{B._binds.call(this);B._unlock.call(this)}D.data("readonly",C)}})},reload:function(){return B.set.call(this,{})},score:function(){return arguments.length?B.setScore.apply(this,arguments):B.getScore.call(this)},set:function(C){return this.each(function(){var E=A(this),D=E.data("settings"),F=A.extend({},D,C);E.raty(F)})},setScore:function(C){return A(this).each(function(){if(A(this).data("readonly")!==true){B._apply.call(this,C);B._target.call(this,C)}})}};A.fn.raty=function(C){if(B[C]){return B[C].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof C==="object"||!C){return B.init.apply(this,arguments)}else{A.error("Method "+C+" does not exist!")}}};A.fn.raty.defaults={cancel:false,cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:"",precision:false,readOnly:false,round:{down:0.25,full:0.6,up:0.76},score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery);